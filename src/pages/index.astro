---
import Layout from "@/layouts/Layout.astro";
import Hero from "@/components/Hero.astro";
import { Image } from "astro:assets";
import { LogoMarquee } from "@/components/LogoMarquee";
import ButtonLink from "@/components/ui/ButtonLink.astro";

const upcomingEventsAndNews = [
  {
    title: "Curso de Seguridad Minera",
    image: "/images/eventos/proximos-eventos/seguridad-minera.jpeg",
    date: "23 - 25 Junio de 2025",
  },
  {
    title: "XI Cumbre Internacional Minera",
    image:
      "/images/eventos/proximos-eventos/xi-cumbre-internacional-minera.jpeg",
    date: "4- 5 Septiembre de 2025",
  }
];

const upcomingEvents = [
  {
    title: "Curso de Seguridad Minera",
    date: "23 - 25 Junio de 2025",
    description: "-",
    month: "jun",
    day: "23"
  },
  {
    title: "XI Cumbre Internacional Minera",
    date: "4 - 5 Septiembre de 2025",
    description: "Machala, Ecuador",
    month: "sep",
    day: "04"
  },
];

const companyLogos = [
  {
    name: "Maccaferri logo",
    image: "/images/convenios/empresas-adherentes/maccaferri.jpg",
    href: "https://www.maccaferri.com/",
  },
  {
    name: "Tecnovoladuras logo",
    image: "/images/convenios/empresas-adherentes/tecnovoladuras.png",
    href: "https://tecnovoladuras.com/",
  },
  {
    name: "Ideal Alambrec logo",
    image: "/images/convenios/empresas-adherentes/ideal-alambrec.png",
    href: "https://idealalambrec.bekaert.com/soluciones-para-la-construccion/mineria",
  },
  {
    name: "Teincomin logo",
    image: "/images/convenios/empresas-adherentes/teincomin.png",
    href: "https://teincomin.com/web/",
  },
];

const interinstitutionalAgreements = [
  {
    name: "Gobierno Autónomo Descentralizado Municipal del Cantón Ibarra",
    image: "/images/convenios/interinstitucionales/municipio-Ibarra.png",
    href: "https://www.ibarra.gob.ec/site/el-gad-municipal/",
  },
  {
    name: "Facultad de Ingeniería en Geología, Minas, Petróleos y Ambiental de la Universidad Central del Ecuador",
    image: "/images/convenios/interinstitucionales/figempa.png",
    href: "https://www.uce.edu.ec/web/figempa",
  },
  {
    name: "RUDN University",
    image: "/images/convenios/interinstitucionales/rudn-university.png",
    href: "https://www.rudn.ru/",
    scale: 0.8,
  },
  {
    name: "Escuela Superior Politécnica del Litoral",
    image: "/images/convenios/cooperacion/espol.png",
    href: "https://www.espol.edu.ec/es",
  },
  {
    name: "Seguridad y Salud Ocupacional",
    image: "/images/convenios/interinstitucionales/consisso.jpg",
    href: "https://consisso.com/",
  },
  {
    name: "Instituto de Investigación Geológico y Energético",
    image: "/images/convenios/interinstitucionales/iige.png",
    href: "https://www.geoenergia.gob.ec/",
  },
];

const cooperationAgreements = [
  {
    name: "Alianza para el Emprendimiento e Innovación",
    image:
      "/images/convenios/cooperacion/alianza-emprendimiento-innovacion.png",
    href: "https://www.aei.ec/",
  },
  {
    name: "CAMIPE",
    image: "/images/convenios/cooperacion/camipe.png",
    scale: 1.2,
  },
  {
    name: "QCS Servicios Profesionales",
    image: "/images/convenios/cooperacion/qcs.png",
    href: "https://qcs.com.ec/",
    scale: 0.9,
  },
  {
    name: "Universidad Técnica de Machachi",
    image: "/images/convenios/cooperacion/universidad-tecnica-de-machachi.png",
    href: "https://www.utmachala.edu.ec/portalwp/",
  },
  {
    name: "Cámara de la Pequeña Minería",
    image:
      "/images/convenios/cooperacion/camara-de-la-pequena-mineria-del-ecuador.png",
    scale: 1.05,
  },
  {
    name: "Intermodal Solutions Group logo",
    image: "/images/convenios/cooperacion/intermodal-solutions-group.png",
    href: "https://pittoship.com/",
    scale: 1.1,
  },
  {
    name: "Cámara de la Industria de la Construcción",
    image: "/images/convenios/interinstitucionales/camicon.png",
    href: "https://camicon.ec/web/",
    scale: 0.75,
  },
  {
    name: "Women In Mining",
    image: "/images/convenios/cooperacion/women-in-mining.jpg",
    href: "https://www.wimecuador.com/",
  },
  {
    name: "Universidad Nacional de Loja",
    image: "/images/convenios/cooperacion/universidad-nacional-de-loja.png",
    href: "https://www.unl.edu.ec/",
  },
];
---

<Layout
  title="AIME - Asociación de Ingenieros de Minas del Ecuador"
  description="Somos una organización técnica científica que agrupa a profesionales de la industria minera ecuatoriana, con reconocimiento a nivel nacional e internacional. ¡Forjemos juntos un futuro exitoso!"
>
  <Hero />

  <section class="py-16 bg-[#FCBF29]">
    <div class="container mx-auto">
      <h2
        class="text-3xl font-bold tracking-tighter sm:text-4xl mb-10 text-center text-gray-900"
      >
        PRÓXIMOS EVENTOS
      </h2>

      <div class="max-w-6xl mx-auto">
        <div class="flex flex-wrap justify-center gap-8 md:gap-12 lg:gap-16">
          {
            upcomingEvents.map((event) => (
              <div
                class="group max-w-[380px] flex-shrink-0 hover:scale-[1.02] transition-transform duration-300"
              >
                <div class="flex flex-col bg-[#f6ca45] rounded-lg overflow-hidden shadow-md">
                  <div class="p-6 flex gap-4">
                    <div class="flex-shrink-0">
                      <div class="text-center">
                        <div>
                          <div class="text-4xl font-bold text-gray-900">
                            {event.day}
                          </div>
                          <div class="text-sm font-medium text-gray-600">
                            {event.month}.
                          </div>
                          <div class="text-xs text-gray-500 mt-1">2025</div>
                        </div>
                      </div>
                    </div>
                    <div class="ml-2">
                      <h3 class="font-bold text-lg text-gray-900">
                        {event.title}
                      </h3>
                      <p class="text-sm text-gray-700 mt-1">
                        {event.description}
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            ))
          }
        </div>

        <div class="text-center mt-10">
          <ButtonLink
            href="/eventos"
            variant="outline"
            class="text-black border border-black/50 hover:text-black"
          >
            Ver todos los eventos
          </ButtonLink>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16">
    <div class="container mx-auto">
      <div class="flex flex-col md:flex-row md:items-end justify-center mb-12">
        <div>
          <div class="flex items-center justify-center space-x-2 mb-2">
            <div class="h-1 w-10 bg-primary"></div>
            <span
              class="text-sm font-medium uppercase tracking-wider text-muted-foreground"
            >
              Novedades
            </span>
            <div class="h-1 w-10 bg-primary"></div>
          </div>
          <h2 class="text-3xl font-bold tracking-tighter sm:text-4xl mt-4">
            ÚLTIMAS NOTICIAS Y EVENTOS
          </h2>
        </div>
      </div>

      <!-- Grid de Últimas Noticias y Eventos -->
      <div
        class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-10 lg:gap-16 xl:flex xl:justify-center xl:gap-24"
      >
        {
          upcomingEventsAndNews.map((event) => (
            <button
              class="xl:max-w-[300px] min-[1800px]:max-w-full hover:scale-[1.02] transition-transform duration-300"
              data-image-src={event.image}
              data-image-alt={event.title}
              aria-label={`Ver imagen ampliada: ${event.title}`}
            >
              <Image
                src={event.image}
                alt={event.title}
                width={300}
                height={225}
                class="w-full h-full xl:h-auto object-cover rounded-md"
              />
              <div class="mt-2">
                <h3 class="font-bold text-lg">{event.title}</h3>
                <p class="text-sm text-muted-foreground mt-1">{event.date}</p>
              </div>
            </button>
          ))
        }
      </div>
      
      <div id="imageModalContainer"></div>
    </div>
  </section>

  <!-- Services/Activities Section 
  <section class="py-16 md:py-24">
    <div class="container">
      <div class="text-center mb-12">
        <div class="flex items-center space-x-2 mb-2 justify-center">
          <div class="h-1 w-10 bg-primary"></div>
          <span class="text-sm font-medium uppercase tracking-wider text-muted-foreground">
            Lo que ofrecemos
          </span>
          <div class="h-1 w-10 bg-primary"></div>
        </div>
        <h2 class="text-3xl font-bold tracking-tighter sm:text-4xl md:text-5xl">
          Nuestros Servicios
        </h2>
        <p class="mt-4 text-muted-foreground max-w-3xl mx-auto">
          AIME ofrece una variedad de servicios y actividades para apoyar a los profesionales de la minería y promover el desarrollo sostenible del sector.
        </p>
      </div>
    </div>
  </section>
-->

  <!-- Convenios Interinstitucionales Section -->
  <section class="pt-5 pb-10 md:pb-18">
    <div class="container">
      <div class="flex items-center space-x-2 mb-2 justify-center">
        <div class="h-1 w-10 bg-primary"></div>
        <span
          class="text-sm font-medium uppercase tracking-wider text-muted-foreground"
        >
          Nuestros Aliados
        </span>
        <div class="h-1 w-10 bg-primary"></div>
      </div>
      <div class="text-center mb-8 flex items-center space-x-2 justify-center">
        <h2 class="text-3xl font-bold tracking-tighter sm:text-4xl lg:text-5xl">
          Empresas Adherentes
        </h2>
      </div>
    </div>
    <div
      class="bg-muted mt-14 px-6 py-10 grid grid-cols-2 gap-6 items-center justify-items-center lg:flex lg:justify-center lg:gap-20"
    >
      {
        companyLogos.map((logo, index) => (
          <a
            href={logo.href || "#"}
            target={logo.href ? "_blank" : ""}
            rel="noopener noreferrer"
            class="transition-transform duration-[250ms] hover:-translate-y-1"
          >
            <Image
              src={logo.image}
              alt={logo.name}
              loading="eager"
              width={150}
              height={80}
              class={`w-auto object-contain animate-duration-[800ms] ${index === 0 ? "max-h-[60px]" : "max-h-20"}`}
              data-fade="up"
            />
          </a>
        ))
      }
    </div>
  </section>

  <section class="pt-5">
    <div class="container">
      <div class="text-center mb-12">
        <h2
          class="text-[22px] font-bold tracking-tighter sm:text-3xl md:text-4xl"
        >
          Convenios Interinstitucionales
        </h2>
        <p class="mt-4 text-muted-foreground max-w-3xl mx-auto">
          Establecemos alianzas estratégicas con entidades académicas y
          gubernamentales para impulsar proyectos de investigación, formación y
          desarrollo que beneficien al sector minero ecuatoriano.
        </p>
      </div>
    </div>
    <LogoMarquee
      logos={[...interinstitutionalAgreements, ...cooperationAgreements]}
      client:visible
    />
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const images = document.querySelectorAll('img[data-fade="up"]');
      if (images.length) {
        const observer = new window.IntersectionObserver(
          (entries, observer) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                entry.target.classList.add("animate-fade-up");
                observer.unobserve(entry.target);
              }
            });
          },
          { threshold: 0.3 }
        );
        images.forEach((img) => observer.observe(img));
      }

      // Lógica para el manejo de la modal de imagen
      const imageButtons = document.querySelectorAll('button[data-image-src]');
      const modalContainer = document.getElementById('imageModalContainer');
      
      if (imageButtons.length && modalContainer) {
        imageButtons.forEach(button => {
          button.addEventListener('click', () => {
            const src = button.getAttribute('data-image-src');
            const alt = button.getAttribute('data-image-alt') || 'Imagen ampliada';
            
            if (src) {
              // Crear modal manualmente
              const modal = document.createElement('div');
              modal.className = 'fixed inset-0 z-50 bg-black/85 flex items-center justify-center p-4 backdrop-blur-sm';
              modal.setAttribute('role', 'dialog');
              modal.setAttribute('aria-modal', 'true');
              modal.setAttribute('aria-label', 'Visor de imagen');
              
              const modalContent = document.createElement('div');
              modalContent.className = 'relative max-w-5xl w-full pt-2';
              
              const closeButton = document.createElement('button');
              closeButton.type = 'button';
              closeButton.className = 'absolute -top-10 right-0 lg:-top-5 hover:text-white text-gray-300 transition-colors';
              closeButton.setAttribute('aria-label', 'Cerrar imagen');
              closeButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="size-6.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';
              
              const image = document.createElement('img');
              image.src = src;
              image.alt = alt;
              image.className = 'w-full h-auto max-h-[90svh] object-contain';
              
              // Ensamblar la modal
              modalContent.appendChild(closeButton);
              modalContent.appendChild(image);
              modal.appendChild(modalContent);
              
              // Manejar cierre de modal
              const closeModal = () => {
                document.body.classList.remove('overflow-hidden');
                modal.remove();
              };
              
              closeButton.addEventListener('click', (e) => {
                e.stopPropagation();
                closeModal();
              });
              
              modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                  closeModal();
                }
              });
              
              image.addEventListener('click', (e) => {
                e.stopPropagation();
              });
              
              // Manejo de tecla Escape
              const handleEscape = (e: KeyboardEvent) => {
                if (e.key === 'Escape') {
                  closeModal();
                  document.removeEventListener('keydown', handleEscape);
                }
              };
              
              document.addEventListener('keydown', handleEscape);
              
              // Mostrar modal
              document.body.classList.add('overflow-hidden');
              modalContainer.appendChild(modal);
            }
          });
        });
      }
    });
  </script>
</Layout>
