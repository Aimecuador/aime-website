---
import Layout from '@/layouts/Layout.astro'
import Hero from '@/components/Hero.astro'
import { Image } from 'astro:assets'
import { LogoMarquee } from '@/components/LogoMarquee'
import ButtonLink from '@/components/ui/ButtonLink.astro'
import { FacebookNew } from '@/components/sections/FacebookNew'

const upcomingEventsAndNews = [
  {
    title: 'Curso de Seguridad Minera',
    image: '/images/eventos/proximos-eventos/seguridad-minera.jpeg',
    date: '23 - 25 Junio de 2025',
  },
  {
    title: 'XI Cumbre Internacional Minera',
    image:
      '/images/eventos/proximos-eventos/xi-cumbre-internacional-minera.jpeg',
    date: '4- 5 Septiembre de 2025',
  },
]

const upcomingEvents = [
  {
    title: 'Curso de Seguridad Minera',
    date: '23 - 25 Junio de 2025',
    description: '-',
    month: 'jun',
    day: '23',
  },
  {
    title: 'XI Cumbre Internacional Minera',
    date: '4 - 5 Septiembre de 2025',
    description: 'Machala, Ecuador',
    month: 'sep',
    day: '04',
  },
]

const companyLogos = [
  {
    name: 'Maccaferri logo',
    image: '/images/convenios/empresas-adherentes/maccaferri.jpg',
    href: 'https://www.maccaferri.com/',
  },
  {
    name: 'Tecnovoladuras logo',
    image: '/images/convenios/empresas-adherentes/tecnovoladuras.png',
    href: 'https://tecnovoladuras.com/',
  },
  {
    name: 'Ideal Alambrec logo',
    image: '/images/convenios/empresas-adherentes/ideal-alambrec.png',
    href: 'https://idealalambrec.bekaert.com/soluciones-para-la-construccion/mineria',
  },
  {
    name: 'Teincomin logo',
    image: '/images/convenios/empresas-adherentes/teincomin.png',
    href: 'https://teincomin.com/web/',
  },
]

const interinstitutionalAgreements = [
  {
    name: 'Gobierno Autónomo Descentralizado Municipal del Cantón Ibarra',
    image: '/images/convenios/interinstitucionales/municipio-Ibarra.png',
    href: 'https://www.ibarra.gob.ec/site/el-gad-municipal/',
  },
  {
    name: 'Facultad de Ingeniería en Geología, Minas, Petróleos y Ambiental de la Universidad Central del Ecuador',
    image: '/images/convenios/interinstitucionales/figempa.png',
    href: 'https://www.uce.edu.ec/web/figempa',
  },
  {
    name: 'RUDN University',
    image: '/images/convenios/interinstitucionales/rudn-university.png',
    href: 'https://www.rudn.ru/',
    scale: 0.8,
  },
  {
    name: 'Escuela Superior Politécnica del Litoral',
    image: '/images/convenios/cooperacion/espol.png',
    href: 'https://www.espol.edu.ec/es',
  },
  {
    name: 'Seguridad y Salud Ocupacional',
    image: '/images/convenios/interinstitucionales/consisso.png',
    href: 'https://consisso.com/',
  },
  {
    name: 'Instituto de Investigación Geológico y Energético',
    image: '/images/convenios/interinstitucionales/iige.jpeg',
    href: 'https://www.geoenergia.gob.ec/',
    scale: 0.8,
  },
]

const cooperationAgreements = [
  {
    name: 'Alianza para el Emprendimiento e Innovación',
    image:
      '/images/convenios/cooperacion/alianza-emprendimiento-innovacion.png',
    href: 'https://www.aei.ec/',
  },
  {
    name: 'CAMIPE',
    image: '/images/convenios/cooperacion/camipe.png',
    scale: 1.2,
  },
  {
    name: 'QCS Servicios Profesionales',
    image: '/images/convenios/cooperacion/qcs.png',
    href: 'https://qcs.com.ec/',
    scale: 0.9,
  },
  {
    name: 'Universidad Técnica de Machachi',
    image: '/images/convenios/cooperacion/universidad-tecnica-de-machachi.png',
    href: 'https://www.utmachala.edu.ec/portalwp/',
  },
  {
    name: 'Cámara de la Pequeña Minería',
    image:
      '/images/convenios/cooperacion/camara-de-la-pequena-mineria-del-ecuador.png',
    scale: 1.05,
  },
  {
    name: 'Intermodal Solutions Group logo',
    image: '/images/convenios/cooperacion/intermodal-solutions-group.png',
    href: 'https://pittoship.com/',
    scale: 1.1,
  },
  {
    name: 'Cámara de la Industria de la Construcción',
    image: '/images/convenios/interinstitucionales/camicon.png',
    href: 'https://camicon.ec/web/',
    scale: 0.75,
  },
  {
    name: 'Women In Mining',
    image: '/images/convenios/cooperacion/women-in-mining.jpg',
    href: 'https://www.wimecuador.com/',
  },
  {
    name: 'Universidad Nacional de Loja',
    image: '/images/convenios/cooperacion/universidad-nacional-de-loja.png',
    href: 'https://www.unl.edu.ec/',
    scale: 0.9,
  },
  {
    name: 'Ministerio de Energía y Minas',
    image:
      '/images/convenios/interinstitucionales/ministerio-de-energia-y-minas.jpeg',
    href: 'https://www.recursosyenergia.gob.ec/',
    scale: 0.9,
  },
]
---

<Layout
  title="AIME - Asociación de Ingenieros de Minas del Ecuador"
  description="Somos una organización técnica científica que agrupa a profesionales de la industria minera ecuatoriana, con reconocimiento a nivel nacional e internacional. ¡Forjemos juntos un futuro exitoso!"
>
  <Hero />

  <section class="bg-[#FCBF29] py-16">
    <div class="container mx-auto">
      <h2
        class="mb-10 text-center text-3xl font-bold tracking-tighter text-gray-900 sm:text-4xl"
      >
        PRÓXIMOS EVENTOS
      </h2>

      <div class="mx-auto max-w-6xl">
        <div class="flex flex-wrap justify-center gap-8 md:gap-12 lg:gap-16">
          {
            upcomingEvents.map((event) => (
              <div class="group max-w-[380px] transition-transform duration-300 hover:scale-[1.02] hover:cursor-pointer">
                <div class="flex gap-4 overflow-hidden rounded-lg bg-[#f6ca45] p-6 shadow-md">
                  <div class="text-center">
                    <div>
                      <div class="text-4xl font-bold text-gray-900">
                        {event.day}
                      </div>
                      <div class="text-sm font-medium text-gray-600">
                        {event.month}.
                      </div>
                      <div class="mt-1 text-xs text-gray-500">2025</div>
                    </div>
                  </div>
                  <div class="ml-2">
                    <h3 class="text-lg font-bold text-gray-900">
                      {event.title}
                    </h3>
                    <p class="mt-1 text-sm text-gray-700">
                      {event.description}
                    </p>
                  </div>
                </div>
              </div>
            ))
          }
        </div>

        <div class="mt-10 text-center">
          <ButtonLink href="/eventos" variant="outline-dark">
            Ver todos los eventos
          </ButtonLink>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16">
    <div class="container mx-auto">
      <div class="mb-12 flex flex-col justify-center md:flex-row md:items-end">
        <div>
          <div class="mb-2 flex items-center justify-center space-x-2">
            <div class="h-1 w-10 bg-primary"></div>
            <span
              class="text-sm font-medium uppercase tracking-wider text-muted-foreground"
            >
              Novedades
            </span>
            <div class="h-1 w-10 bg-primary"></div>
          </div>
          <h2 class="mt-4 text-3xl text-center font-bold tracking-tighter sm:text-4xl">
            ÚLTIMAS NOTICIAS Y EVENTOS
          </h2>
        </div>
      </div>

      <!-- Box de Últimas Noticias y Eventos -->
      <div
        id="eventsAndNewsGrid"
        class="mt-16 flex flex-col flex-wrap items-center justify-center sm:flex-row gap-10 lg:gap-16 xl:gap-24"
      >
        {
          upcomingEventsAndNews.map((event) => (
            <article
              role="button"
              tabindex="0"
              class="w-full transition-transform duration-300 hover:scale-[1.02] sm:max-w-[300px]"
              data-image-src={event.image}
              data-image-alt={event.title}
              aria-label={`Ver imagen ampliada: ${event.title}`}
            >
              <Image
                src={event.image}
                alt={event.title}
                width={300}
                height={225}
                class="h-full w-full rounded-md object-cover xl:h-auto"
              />
              <div class="mt-2">
                <h3 class="text-lg font-bold">{event.title}</h3>
                <p class="mt-1 text-sm text-muted-foreground">{event.date}</p>
              </div>
            </article>
          ))
        }

        <FacebookNew client:load />
      </div>

      <div id="imageModalContainer"></div>
    </div>
  </section>

  <!-- Convenios Interinstitucionales Section -->
  <section class="md:pb-18 pb-10 pt-5">
    <div class="container">
      <div class="mb-2 flex items-center justify-center space-x-2">
        <div class="h-1 w-10 bg-primary"></div>
        <span
          class="text-sm font-medium uppercase tracking-wider text-muted-foreground"
        >
          Nuestros Aliados
        </span>
        <div class="h-1 w-10 bg-primary"></div>
      </div>
      <div class="mb-8 flex items-center justify-center space-x-2 text-center">
        <h2 class="text-3xl font-bold tracking-tighter sm:text-4xl lg:text-5xl">
          Empresas Adherentes
        </h2>
      </div>
    </div>
    <div
      class="mt-14 grid grid-cols-2 items-center justify-items-center gap-6 bg-muted px-6 py-10 lg:flex lg:justify-center lg:gap-20"
    >
      {
        companyLogos.map((logo, index) => (
          <a
            href={logo.href || '#'}
            target={logo.href ? '_blank' : ''}
            rel="noopener noreferrer"
            class="transition-transform duration-[250ms] hover:-translate-y-1"
          >
            <Image
              src={logo.image}
              alt={logo.name}
              loading="eager"
              width={150}
              height={80}
              class={`w-auto object-contain animate-duration-[800ms] ${index === 0 ? 'max-h-[60px]' : 'max-h-20'}`}
              data-fade="up"
            />
          </a>
        ))
      }
    </div>
  </section>

  <section class="mb-14 pt-5">
    <div class="container">
      <div class="mb-12 text-center">
        <h2
          class="text-[22px] font-bold tracking-tighter sm:text-3xl md:text-4xl"
        >
          Convenios Interinstitucionales
        </h2>
        <p class="mx-auto mt-4 max-w-3xl text-muted-foreground">
          Establecemos alianzas estratégicas con entidades académicas y
          gubernamentales para impulsar proyectos de investigación, formación y
          desarrollo que beneficien al sector minero ecuatoriano.
        </p>
      </div>
    </div>
    <LogoMarquee
      logos={[...interinstitutionalAgreements, ...cooperationAgreements]}
      client:visible
    />
  </section>

  <script is:inline>
    const images = document.querySelectorAll('img[data-fade="up"]')
    if (images.length) {
      const observer = new window.IntersectionObserver(
        (entries, observer) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('animate-fade-up')
              observer.unobserve(entry.target)
            }
          })
        },
        { threshold: 0.3 },
      )
      images.forEach((img) => observer.observe(img))
    }

    function setupModalImageHandlers() {
      const modalContainer = document.getElementById('imageModalContainer')
      const imageButtons = document.querySelectorAll('article[data-image-src]')

      if (imageButtons.length && modalContainer) {
        imageButtons.forEach((button) => {
          button.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault()
              button.click()
            }
          })

          button.addEventListener('click', () => {
            const src = button.getAttribute('data-image-src')
            const alt =
              button.getAttribute('data-image-alt') || 'Imagen ampliada'

            if (src) {
              const modal = document.createElement('div')
              modal.className = 'modal-backdrop'
              modal.setAttribute('role', 'dialog')
              modal.setAttribute('aria-modal', 'true')
              modal.setAttribute('aria-label', 'Visor de imagen')

              modal.innerHTML = `
                <div class="modal-content">
                  <button type="button" aria-label="Cerrar imagen" class="modal-close-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="18" y1="6" x2="6" y2="18" />
                      <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                  </button>
                  <img src="${src}" alt="${alt}" class="modal-image" />
                </div>
              `

              const closeButton = modal.querySelector('button')
              const image = modal.querySelector('img')

              const closeModal = () => {
                document.body.classList.remove('overflow-hidden')
                modal.remove()
              }

              closeButton.addEventListener('click', (e) => {
                e.stopPropagation()
                closeModal()
              })

              modal.addEventListener('click', (e) => {
                if (e.target === modal) closeModal()
              })

              image.addEventListener('click', (e) => {
                e.stopPropagation()
              })

              const handleEscape = (e) => {
                if (e.key === 'Escape') {
                  closeModal()
                  document.removeEventListener('keydown', handleEscape)
                }
              }
              document.addEventListener('keydown', handleEscape)

              document.body.classList.add('overflow-hidden')
              modalContainer.appendChild(modal)
            }
          })
        })
      }
    }

    document.addEventListener('astro:page-load', setupModalImageHandlers)
  </script>
</Layout>
